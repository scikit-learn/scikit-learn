.. include:: _contributors.rst

.. currentmodule:: sklearn

.. _changes_1_1:

Version 1.1.0
=============

**In Development**


.. include:: changelog_legend.inc

Minimal dependencies
--------------------

Version 1.1.0 of scikit-learn requires python 3.8+, numpy 1.17.3+ and
scipy 1.3.2+. Optional minimal dependency is matplotlib 3.1.2+.

Put the changes in their relevant module.

Changed models
--------------

The following estimators and functions, when fit with the same data and
parameters, may produce different models from the previous version. This often
occurs due to changes in the modelling logic (bug fixes or enhancements), or in
random sampling procedures.

- |Efficiency| :class:`cluster.KMeans` now defaults to ``algorithm="lloyd"``
  instead of ``algorithm="auto"``, which was equivalent to
  ``algorithm="elkan"``. Lloyd's algorithm and Elkan's algorithm converge to the
  same solution, up to numerical rounding errors, but in general Lloyd's
  algorithm uses much less memory, and it is often faster.

- |Fix| The eigenvectors initialization for :class:`cluster.SpectralClustering`
  and :class:`manifold.SpectralEmbedding` now samples from a Gaussian when
  using the `'amg'` or `'lobpcg'` solver. This change  improves numerical
  stability of the solver, but may result in a different model.

- |Fix| :func:`feature_selection.f_regression` and
  :func:`feature_selection.r_regression` will now returned finite score by
  default instead of `np.nan` and `np.inf` for some corner case. You can use
  `force_finite=False` if you really want to get non-finite values and keep
  the old behavior.

- |Fix| Panda's DataFrames with all non-string columns such as a MultiIndex no
  longer warns when passed into an Estimator. Estimators will continue to
  ignore the column names in DataFrames with non-string columns. For
  `feature_names_in_` to be defined, columns must be all strings. :pr:`22410` by
  `Thomas Fan`_.

- |Fix| :class:`preprocessing.KBinsDiscretizer` changed handling of bin edges
  slightly, which might result in a different encoding with the same data.

- |Fix| :func:`calibration.calibration_curve` changed handling of bin
  edges slightly, which might result in a different output curve given the same
  data.

- |Fix| :class:`discriminant_analysis.LinearDiscriminantAnalysis` now uses
  the correct variance-scaling coefficient which may result in different model
  behavior.

Changelog
---------

..
    Entries should be grouped by module (in alphabetic order) and prefixed with
    one of the labels: |MajorFeature|, |Feature|, |Efficiency|, |Enhancement|,
    |Fix| or |API| (see whats_new.rst for descriptions).
    Entries should be ordered by those labels (e.g. |Fix| after |Efficiency|).
    Changes not specific to a module should be listed under *Multiple Modules*
    or *Miscellaneous*.
    Entries should end with:
    :pr:`123456` by :user:`Joe Bloggs <joeongithub>`.
    where 123456 is the *pull request* number, not the issue number.

- |Efficiency| Low-level routines for reductions on pairwise distances
  for dense float64 datasets have been refactored. The following functions
  and estimators now benefit from improved performances in terms of hardware
  scalability and speed-ups:
  - :func:`sklearn.metrics.pairwise_distances_argmin`
  - :func:`sklearn.metrics.pairwise_distances_argmin_min`
  - :class:`sklearn.cluster.AffinityPropagation`
  - :class:`sklearn.cluster.Birch`
  - :class:`sklearn.cluster.MeanShift`
  - :class:`sklearn.cluster.OPTICS`
  - :class:`sklearn.cluster.SpectralClustering`
  - :func:`sklearn.feature_selection.mutual_info_regression`
  - :class:`sklearn.neighbors.KNeighborsClassifier`
  - :class:`sklearn.neighbors.KNeighborsRegressor`
  - :class:`sklearn.neighbors.RadiusNeighborsClassifier`
  - :class:`sklearn.neighbors.RadiusNeighborsRegressor`
  - :class:`sklearn.neighbors.LocalOutlierFactor`
  - :class:`sklearn.neighbors.NearestNeighbors`
  - :class:`sklearn.manifold.Isomap`
  - :class:`sklearn.manifold.LocallyLinearEmbedding`
  - :class:`sklearn.manifold.TSNE`
  - :func:`sklearn.manifold.trustworthiness`
  - :class:`sklearn.semi_supervised.LabelPropagation`
  - :class:`sklearn.semi_supervised.LabelSpreading`

  For instance :class:`sklearn.neighbors.NearestNeighbors.kneighbors` and
  :class:`sklearn.neighbors.NearestNeighbors.radius_neighbors`
  can respectively be up to ×20 and ×5 faster than previously.

  :pr:`21987`, :pr:`22064`, :pr:`22065`, :pr:`22288` and :pr:`22320`
  by :user:`Julien Jerphanion <jjerphan>`

- |Enhancement| All scikit-learn models now generate a more informative
  error message when some input contains unexpected `NaN` or infinite values.
  In particular the message contains the input name ("X", "y" or
  "sample_weight") and if an unexpected `NaN` value is found in `X`, the error
  message suggests potential solutions.
  :pr:`21219` by :user:`Olivier Grisel <ogrisel>`.

- |Enhancement| All scikit-learn models now generate a more informative
  error message when setting invalid hyper-parameters with `set_params`.
  :pr:`21542` by :user:`Olivier Grisel <ogrisel>`.

:mod:`sklearn.calibration`
..........................

- |Enhancement| :func:`calibration.calibration_curve` accepts a parameter
  `pos_label` to specify the positive class label.
  :pr:`21032` by :user:`Guillaume Lemaitre <glemaitre>`.

- |Fix| :func:`calibration.calibration_curve` handles bin edges more consistently now.
  :pr:`14975` by `Andreas Müller`_ and :pr:`22526` by :user:`Meekail Zain <micky774>`.

- |Enhancement| :class:`CalibrationDisplay` accepts a parameter `pos_label` to
  add this information to the plot.
  :pr:`21038` by :user:`Guillaume Lemaitre <glemaitre>`.

- |Enhancement| :meth:`calibration.CalibratedClassifierCV.fit` now supports passing
  `fit_params`, which are routed to the `base_estimator`.
  :pr:`18170` by :user:`Benjamin Bossan <BenjaminBossan>`.

:mod:`sklearn.cluster`
......................

- |Enhancement| :class:`cluster.SpectralClustering` and :func:`cluster.spectral`
  now include the new `'cluster_qr'` method from :func:`cluster.cluster_qr`
  that clusters samples in the embedding space as an alternative to the existing
  `'kmeans'` and `'discrete'` methods.
  See :func:`cluster.spectral_clustering` for more details.
  :pr:`21148` by :user:`Andrew Knyazev <lobpcg>`.

- |Fix| :class:`cluster.KMeans`'s `init` parameter now properly supports
  array-like input and NumPy string scalars. :pr:`22154` by `Thomas Fan`_.

- |Enhancement| Adds :term:`get_feature_names_out` to :class:`cluster.Birch`,
  :class:`cluster.FeatureAgglomeration`, :class:`cluster.KMeans`,
  :class:`cluster.MiniBatchKMeans`. :pr:`22255` by `Thomas Fan`_.

- |Efficiency| In :class:`cluster.KMeans`, the default ``algorithm`` is now
  ``"lloyd"`` which is the full classical EM-style algorithm. Both ``"auto"``
  and ``"full"`` are deprecated and will be removed in version 1.3. They are
  now aliases for ``"lloyd"``. The previous default was ``"auto"``, which relied
  on Elkan's algorithm. Lloyd's algorithm uses less memory than Elkan's, it
  is faster on many datasets, and its results are identical, hence the change.
  :pr:`21735` by :user:`Aurélien Geron <ageron>`.

- |Enhancement| :class:`cluster.SpectralClustering` now raises consistent
  error messages when passed invalid values for `n_clusters`, `n_init`,
  `gamma`, `n_neighbors`, `eigen_tol` or `degree`.
  :pr:`21881` by :user:`Hugo Vassard <hvassard>`.

- |Enhancement| :class:`cluster.AffinityPropagation` now returns cluster
  centers and labels if they exist, even if the model has not fully converged.
  When returning these potentially-degenerate cluster centers and labels, a new
  warning message is shown. If no cluster centers were constructed,
  then the cluster centers remain an empty list with labels set to
  `-1` and the original warning message is shown.
  :pr:`22217` by :user:`Meekail Zain <micky774>`.

:mod:`sklearn.compose`
......................

- |Fix| :class:`compose.ColumnTransformer` now removes validation errors from
  `__init__` and `set_params` methods.
  :pr:`22537` by :user:`iofall <iofall>` and :user:`Arisa Y. <arisayosh>`.

- |Fix| :term:`get_feature_names_out` functionality in
  :class:`compose.ColumnTransformer` was broken when columns were specified
  using `slice`. This is fixed in :pr:`22775` by :user:`randomgeek78
  <randomgeek78>`

:mod:`sklearn.cross_decomposition`
..................................

- |Enhancement| :func:`cross_decomposition._PLS.inverse_transform` now allows
  reconstruction of a `X` target when a `Y` parameter is given. :pr:`19680` by
  :user:`Robin Thibaut <robinthibaut>`.

- |Enhancement| Adds :term:`get_feature_names_out` to all transformers in the
  :mod:`~sklearn.cross_decomposition` module:
  :class:`cross_decomposition.CCA`,
  :class:`cross_decomposition.PLSSVD`,
  :class:`cross_decomposition.PLSRegression`,
  and :class:`cross_decomposition.PLSCanonical`. :pr:`22119` by `Thomas Fan`_.

:mod:`sklearn.covariance`
.........................

- |Fix| :class:`covariance.GraphicalLassoCV` now accepts NumPy array for the
  parameter `alphas`.
  :pr:`22493` by :user:`Guillaume Lemaitre <glemaitre>`.

:mod:`sklearn.datasets`
.......................

- |Enhancement| :func:`datasets.make_swiss_roll` now supports the optional argument
  hole; when set to True, it returns the swiss-hole dataset. :pr:`21482` by
  :user:`Sebastian Pujalte <pujaltes>`.

- |Enhancement| :func:`datasets.make_blobs` no longer copies data during the generation
  process, therefore uses less memory.
  :pr:`22412` by :user:`Zhehao Liu <MaxwellLZH>`.

- |Enhancement| :func:`datasets.load_diabetes` now accepts the parameter
  ``scaled``, to allow loading unscaled data. The scaled version of this
  dataset is now computed from the unscaled data, and can produce slightly
  different results that in previous version (within a 1e-4 absolute
  tolerance).
  :pr:`16605` by :user:`Mandy Gu <happilyeverafter95>`.

- |Enhancement| :func:`datasets.fetch_openml` now has two optional arguments
  `n_retries` and `delay`. By default, :func:`datasets.fetch_openml` will retry
  3 times in case of a network failure with a delay between each try.
  :pr:`21901` by :user:`Rileran <rileran>`.

- |Feature| :func:`datasets.load_files` now accepts a ignore list and
  an allow list based on file extensions.
  :pr:`19747` by :user:`Tony Attalla <tonyattalla>` and :pr:`22498` by
  :user:`Meekail Zain <micky774>`.

:mod:`sklearn.decomposition`
............................

- |Enhancement| :class:`decomposition.PCA` exposes a parameter `n_oversamples` to tune
  :func:`sklearn.decomposition.randomized_svd` and
  get accurate results when the number of features is large.
  :pr:`21109` by :user:`Smile <x-shadow-man>`.

- |Enhancement| :func:`decomposition.dict_learning`, :func:`decomposition.dict_learning_online`
  and :func:`decomposition.sparse_encode` preserve dtype for `numpy.float32`.
  :class:`decomposition.DictionaryLearning`, :class:`decompsition.MiniBatchDictionaryLearning`
  and :class:`decomposition.SparseCoder` preserve dtype for `numpy.float32`.
  :pr:`22002` by :user:`Takeshi Oura <takoika>`.

- |Enhancement| :class:`decomposition.SparsePCA` and :class:`decomposition.MiniBatchSparsePCA`
  preserve dtype for `numpy.float32`.
  :pr:`22111` by :user:`Takeshi Oura <takoika>`.

- |Enhancement| :class:`decomposition.TruncatedSVD` now allows n_components == n_features, if
  `algorithm='randomized'`.
  :pr:`22181` by :user:`Zach Deane-Mayer <zachmayer>`.

- |Enhancement| Adds :term:`get_feature_names_out` to all transformers in the
  :mod:`~sklearn.decomposition` module:
  :class:`~sklearn.decomposition.DictionaryLearning`,
  :class:`~sklearn.decomposition.FactorAnalysis`,
  :class:`~sklearn.decomposition.FastICA`,
  :class:`~sklearn.decomposition.IncrementalPCA`,
  :class:`~sklearn.decomposition.KernelPCA`,
  :class:`~sklearn.decomposition.LatentDirichletAllocation`,
  :class:`~sklearn.decomposition.MiniBatchDictionaryLearning`,
  :class:`~sklearn.decomposition.MiniBatchSparsePCA`,
  :class:`~sklearn.decomposition.NMF`,
  :class:`~sklearn.decomposition.PCA`,
  :class:`~sklearn.decomposition.SparsePCA`,
  and :class:`~sklearn.decomposition.TruncatedSVD`. :pr:`21334` by
  `Thomas Fan`_.

- |Fix| :class:`decomposition.FastICA` now validates input parameters in `fit`
  instead of `__init__`.
  :pr:`21432` by :user:`Hannah Bohle <hhnnhh>` and
  :user:`Maren Westermann <marenwestermann>`.

- |Fix| :class:`decomposition.FactorAnalysis` now validates input parameters
  in `fit` instead of `__init__`.
  :pr:`21713` by :user:`Haya <HayaAlmutairi>` and
  :user:`Krum Arnaudov <krumeto>`.

- |Fix| :class:`decomposition.KernelPCA` now validates input parameters in
  `fit` instead of `__init__`.
  :pr:`21567` by :user:`Maggie Chege <MaggieChege>`.

- |Enhancement| :class:`decomposition.TruncatedSVD` exposes the parameter
  `n_oversamples` and `power_iteration_normalizer` to tune
  :func:`sklearn.decomposition.randomized_svd` and
  get accurate results when the number of features is large, the rank of
  the matrix is high, or other features of the matrix make low rank
  approximation difficult.
  :pr:`21705` by :user:`Jay S. Stanley III <stanleyjs>`.

- |Enhancement| :class:`decomposition.PCA` exposes the parameter
  `power_iteration_normalizer` to tune
  :func:`sklearn.decomposition.randomized_svd` and
  get more accurate results when low rank approximation is difficult.
  :pr:`21705` by :user:`Jay S. Stanley III <stanleyjs>`.

- |Fix| :class:`decomposition.PCA` and :class:`decomposition.IncrementalPCA`
  more safely calculate precision using the inverse of the covariance matrix
  if `self.noise_variance_` is zero.
  :pr:`22300` by :user:`Meekail Zain <micky774>` and :pr:`15948` by
  :user:`sysuresh`.

- |Fix| Greatly reduced peak memory usage in :class:`decomposition.PCA` when
  calling `fit` or `fit_transform`.
  :pr:`22553` by :user:`Meekail Zain <micky774>`.

:mod:`sklearn.discriminant_analysis`
....................................

- |Fix| :class:`discriminant_analysis.LinearDiscriminantAnalysis` now uses
  the correct variance-scaling coefficient which may result in different model
  behavior.:pr:`15984` by :user:`Okon Samuel <OkonSamuel>` :pr:`22696` by
  :user:`Meekail Zain <micky774>`.

- |Enhancement| Adds :term:`get_feature_names_out` to
  :class:`discriminant_analysis.LinearDiscriminantAnalysis`. :pr:`22120` by
  `Thomas Fan`_.

:mod:`sklearn.dummy`
....................

- |Fix| :class:`dummy.DummyRegressor` no longer overrides the `constant`
  parameter during `fit`. :pr:`22486` by `Thomas Fan`_.

:mod:`sklearn.ensemble`
.......................

- |MajorFeature| Added additional option `loss="quantile"` to
  :class:`ensemble.HistGradientBoostingRegressor` for modelling quantiles.
  The quantile level can be specified with the new parameter `quantile`.
  :pr:`21800` and :pr:`20567` by :user:`Christian Lorentzen <lorentzenchr>`.

- |Efficiency| :meth:`fit` of :class:`ensemble.BaseGradientBoosting` now
  calls :func:`check_array` with parameter `force_all_finite=False` for non
  initial warm-start runs as it has already been checked before.
  :pr:`22159` by :user:`Geoffrey Paris <Geoffrey-Paris>`.

- |Enhancement| :class:`ensemble.HistGradientBoostingClassifier` is faster,
  for binary and in particular for multiclass problems thanks to the new private loss
  function module.
  :pr:`20811`, :pr:`20567` and :pr:`21814` by
  :user:`Christian Lorentzen <lorentzenchr>`.

- |Fix| Change the parameter `validation_fraction` in
  :class:`ensemble.BaseGradientBoosting` so that an error is raised if anything
  other than a float is passed in as an argument.
  :pr:`21632` by :user:`Genesis Valencia <genvalen>`

- |API| Changed the default of :func:`max_features` to 1.0 for
  :class:`ensemble.RandomForestRegressor` and to `"sqrt"` for
  :class:`ensemble.RandomForestClassifier`. Note that these give the same fit
  results as before, but are much easier to understand. The old default value
  `"auto"` has been deprecated and will be removed in version 1.3. The same
  changes are also applied for :class:`ensemble.ExtraTreesRegressor` and
  :class:`ensemble.ExtraTreesClassifier`.
  :pr:`20803` by :user:`Brian Sun <bsun94>`.

- |Enhancement| Adds :meth:`get_feature_names_out` to
  :class:`ensemble.VotingClassifier`, :class:`ensemble.VotingRegressor`,
  :class:`ensemble.StackingClassifier`, and
  :class:`ensemble.StackingRegressor`. :pr:`22695` and :pr:`22697`  by `Thomas Fan`_.

- |Fix| Removed a potential source of CPU oversubscription in
  :class:`ensemble.HistGradientBoostingClassifier` and
  :class:`ensemble.HistGradientBoostingRegressor` when CPU resource usage is limited,
  for instance using cgroups quota in a docker container. :pr:`22566` by
  :user:`Jérémie du Boisberranger <jeremiedbb>`.

:mod:`sklearn.feature_extraction`
.................................

- |Feature| Added auto mode to
  :class:`feature_selection.SequentialFeatureSelection`. If the argument
  `n_features_to_select` is `'auto'`, select features until the score
  improvement does not exceed the argument `tol`. The default value of
  `n_features_to_select` changed from `None` to `'warn'` in 1.1 and will become
  `'auto'` in 1.3. `None` and `'warn'` will be removed in 1.3. :pr:`20145` by
  :user:`murata-yu`.

:mod:`sklearn.feature_selection`
................................

- |Efficiency| Improve runtime performance of :func:`feature_selection.chi2`
  with boolean arrays. :pr:`22235` by `Thomas Fan`_.

:mod:`sklearn.feature_selection`
................................
- |Efficiency| Reduced memory usage of :func:`feature_selection.chi2`.
  :pr:`21837` by :user:`Louis Wagner <lrwagner>`.

- |Efficiency|  Fitting a :class:`ensemble.RandomForestClassifier`,
  :class:`ensemble.RandomForestRegressor`, :class:`ensemble.ExtraTreesClassifier`,
  :class:`ensemble.ExtraTreesRegressor`, and :class:`ensemble.RandomTreesEmbedding`
  is now faster in a multiprocessing setting, especially for subsequent fits with
  `warm_start` enabled.
  :pr:`22106` by :user:`Pieter Gijsbers <PGijsbers>`.

- |Enhancement| Adds support to use pre-fit models with `cv="prefit"`
  in :class:`ensemble.StackingClassifier` and :class:`ensemble.StackingRegressor`.
  :pr:`16748` by :user:`Siqi He <siqi-he>` and :pr:`22215` by
  :user:`Meekail Zain <micky774>`.

- |Enhancement| :class:`feature_selection.GenericUnivariateSelect` preserves
  float32 dtype. :pr:`18482` by :user:`Thierry Gameiro <titigmr>`
  and :user:`Daniel Kharsa <aflatoune>` and :pr:`22370` by
  :user:`Meekail Zain <micky774>`.

:mod:`sklearn.feature_extraction`
.................................

- |API| :func:`decomposition.FastICA` now supports unit variance for whitening.
  The default value of its `whiten` argument will change from `True`
  (which behaves like `'arbitrary-variance'`) to `'unit-variance'` in version 1.3.
  :pr:`19490` by :user:`Facundo Ferrin <fferrin>` and
  :user:`Julien Jerphanion <jjerphan>`.

- |Fix| :class:`feature_extraction.FeatureHasher` now validates input parameters
  in `transform` instead of `__init__`. :pr:`21573` by
  :user:`Hannah Bohle <hhnnhh>` and :user:`Maren Westermann <marenwestermann>`.

:mod:`sklearn.feature_extraction.text`
......................................

- |Fix| :class:`feature_extraction.text.TfidfVectorizer` now does not create
  a :class:`feature_extraction.text.TfidfTransformer` at `__init__` as required
  by our API.
  :pr:`21832` by :user:`Guillaume Lemaitre <glemaitre>`.

:mod:`sklearn.feature_selection`
................................

- |Enhancement| Add a parameter `force_finite` to
  :func:`feature_selection.f_regression` and
  :func:`feature_selection.r_regression`. This parameter allows to force the
  output to be finite in the case where a feature or a the target is constant
  or that the feature and target are perfectly correlated (only for the
  F-statistic).
  :pr:`17819` by :user:`Juan Carlos Alfaro Jiménez <alfaro96>`.

:mod:`sklearn.gaussian_process`
...............................

- |Fix| `predict` and `sample_y` methods of
  :class:`sklearn.gaussian_process.GaussianProcessRegressor` now return
  arrays of the correct shape in single-target and multi-target cases, and for
  both `normalize_y=False` and `normalize_y=True`.
  :pr:`22199` by :user:`Guillaume Lemaitre <glemaitre>`,
  :user:`Aidar Shakerimoff <AidarShakerimoff>` and
  :user:`Tenavi Nakamura-Zimmerer <Tenavi>`.

- |Fix| :class:`gaussian_process.GaussianProcessClassifier` raises
  a more informative error if `CompoundKernel` is passed via `kernel`.
  :pr:`22223` by :user:`MarcoM <marcozzxx810>`.

:mod:`sklearn.ensemble`
.......................
- |Enhancement| :class:`ensemble.RandomTreesEmbedding` now has an informative
  :func:`get_feature_names_out` function that includes both tree index and leaf index in
  the output feature names.
  :pr:`21762` by :user:`Zhehao Liu <MaxwellLZH>` and `Thomas Fan`_.

:mod:`sklearn.impute`
.....................

- |Enhancement| Added support for `pd.NA` in :class:`SimpleImputer`.
  :pr:`21114` by :user:`Ying Xiong <yxiong>`.

- |Enhancement| Adds :meth:`get_feature_names_out` to
  :class:`impute.SimpleImputer`, :class:`impute.KNNImputer`,
  :class:`impute.IterativeImputer`, and :class:`impute.MissingIndicator`.
  :pr:`21078` by `Thomas Fan`_.

- |API| The `verbose` parameter was deprecated for :class:`impute.SimpleImputer`.
  A warning will always be raised upon the removal of empty columns.
  :pr:`21448` by :user:`Oleh Kozynets <OlehKSS>` and
  :user:`Christian Ritter <chritter>`.

- |Enhancement| :class:`SimpleImputer` now warns with feature names
  when features which are skipped due to the lack of any observed
  values in the training set.
  :pr:`21617` by :user:`Christian Ritter <chritter>`.

- |Enhancement| :class:`linear_model.RidgeClassifier` is now supporting
  multilabel classification.
  :pr:`19689` by :user:`Guillaume Lemaitre <glemaitre>`.

- |Enhancement| :class:`linear_model.RidgeCV` and
  :class:`linear_model.RidgeClassifierCV` now raise consistent error message
  when passed invalid values for `alphas`.
  :pr:`21606` by :user:`Arturo Amor <ArturoAmorQ>`.

- |Enhancement| :class:`linear_model.Ridge` and :class:`linear_model.RidgeClassifier`
  now raise consistent error message when passed invalid values for `alpha`,
  `max_iter` and `tol`.
  :pr:`21341` by :user:`Arturo Amor <ArturoAmorQ>`.

:mod:`sklearn.inspection`
.........................

- |Enhancement| In
  :meth:`~sklearn.inspection.PartialDependenceDisplay.from_estimator` and
  :meth:`~sklearn.inspection.PartialDependenceDisplay.from_predictions`, allow
  `kind` to accept a list of strings to specify  which type of
  plot to draw for each feature interaction.
  :pr:`19438` by :user:`Guillaume Lemaitre <glemaitre>`.

:mod:`sklearn.isotonic`
.......................

- |Enhancement| Adds :term:`get_feature_names_out` to `IsotonicRegression`.
  :pr:`22249` by `Thomas Fan`_.

:mod:`sklearn.kernel_approximation`
...................................

- |Enhancement| Adds :meth:`get_feature_names_out` to
  :class:`kernel_approximation.AdditiveChi2Sampler`.
  :class:`kernel_approximation.Nystroem`,
  :class:`kernel_approximation.PolynomialCountSketch`,
  :class:`kernel_approximation.RBFSampler`, and
  :class:`kernel_approximation.SkewedChi2Sampler`.
  :pr:`22137` and :pr:`22694` by `Thomas Fan`_.

:mod:`sklearn.linear_model`
...........................

- |API| :class:`linear_model.LassoLarsIC` now exposes `noise_variance` as
  a parameter in order to provide an estimate of the noise variance.
  This is particularly relevant when `n_features > n_samples` and the
  estimator of the noise variance cannot be computed.
  :pr:`21481` by :user:`Guillaume Lemaitre <glemaitre>`.

- |Enhancement| :func:`orthogonal_mp_gram` preservse dtype for `numpy.float32`.
  :pr:`22002` by :user:`Takeshi Oura <takoika>`.

- |Enhancement| :class:`linear_model.QuantileRegressor` support sparse input
  for the highs based solvers.
  :pr:`21086` by :user:`Venkatachalam Natchiappan <venkyyuvy>`.
  In addition, those solvers now use the CSC matrix right from the
  beginning which speeds up fitting.
  :pr:`22206` by :user:`Christian Lorentzen <lorentzenchr>`.

- |Enhancement| :class:`~linear_model.LogisticRegression` is faster for
  ``solvers="lbfgs"`` and ``solver="newton-cg"``, for binary and in particular for
  multiclass problems thanks to the new private loss function module. In the multiclass
  case, the memory consumption has also been reduced for these solvers as the target is
  now label encoded (mapped to integers) instead of label binarized (one-hot encoded).
  The more classes, the larger the benefit.
  :pr:`21808`, :pr:`20567` and :pr:`21814` by
  :user:`Christian Lorentzen <lorentzenchr>`.

- |Enhancement| Rename parameter `base_estimator` to `estimator` in
  :class:`linear_model.RANSACRegressor` to improve readability and consistency.
  `base_estimator` is deprecated and will be removed in 1.3.
  :pr:`22062` by :user:`Adrian Trujillo <trujillo9616>`.

- |Fix| :class:`linear_model.LassoLarsIC` now correctly computes AIC
  and BIC. An error is now raised when `n_features > n_samples` and
  when the noise variance is not provided.
  :pr:`21481` by :user:`Guillaume Lemaitre <glemaitre>` and
  :user:`Andrés Babino <ababino>`.

- |Enhancement| :func:`linear_model.ElasticNet` and
  and other linear model classes using coordinate descent show error
  messages when non-finite parameter weights are produced. :pr:`22148`
  by :user:`Christian Ritter <chritter>` and :user:`Norbert Preining <norbusan>`.

- |Fix| :class:`linear_model.ElasticNetCV` now produces correct
  warning when `l1_ratio=0`.
  :pr:`21724` by :user:`Yar Khine Phyo <yarkhinephyo>`.

- |Enhancement| :class:`linear_model.ElasticNet` and :class:`linear_model.Lasso`
  now raise consistent error messages when passed invalid values for `l1_ratio`,
  `alpha`, `max_iter` and `tol`.
  :pr:`22240` by :user:`Arturo Amor <ArturoAmorQ>`.

- |Fix| :class:`linear_model.LogisticRegression` and
  :class:`linear_model.LogisticRegressionCV` now set the `n_iter_` attribute
  with a shape that respects the docstring and that is consistent with the shape
  obtained when using the other solvers in the one-vs-rest setting. Previously,
  it would record only the maximum of the number of iterations for each binary
  sub-problem while now all of them are recorded. :pr:`21998` by
  :user:`Olivier Grisel <ogrisel>`.

- |Enhancement| :class:`linear_model.BayesianRidge` and
  :class:`linear_model.ARDRegression` now preserve float32 dtype. :pr:`9087` by
  :user:`Arthur Imbert <Henley13>` and :pr:`22525` by :user:`Meekail Zain <micky774>`.

:mod:`sklearn.manifold`
.......................

- |Feature| :class:`sklearn.manifold.Isomap` now supports radius-based
  neighbors via the `radius` argument.
  :pr:`19794` by :user:`Zhehao Liu <MaxwellLZH>`.

- |Enhancement| :func:`manifold.spectral_embedding` and
  :class:`manifold.SpectralEmbedding` supports `np.float32` dtype and will
  preserve this dtype.
  :pr:`21534` by :user:`Andrew Knyazev <lobpcg>`.

- |Enhancement| Adds `get_feature_names_out` to :class:`manifold.Isomap`
  and :class:`manifold.LocallyLinearEmbedding`. :pr:`22254` by `Thomas Fan`_.

- |Fix| :func:`manifold.spectral_embedding` now uses Gaussian instead of
  the previous uniform on [0, 1] random initial approximations to eigenvectors
  in eigen_solvers `lobpcg` and `amg` to improve their numerical stability.
  :pr:`21565` by :user:`Andrew Knyazev <lobpcg>`.

- |Enhancement| added `metric_params` to :class:`manifold.TSNE` constructor for
  additional parameters of distance metric to use in optimization.
  :pr:`21805` by :user:`Jeanne Dionisi <jeannedionisi>` and :pr:`22685` by
  :user:`Meekail Zain <micky774>`.

:mod:`sklearn.metrics`
......................

- |Feature| :func:`r2_score` and :func:`explained_variance_score` have a new
  `force_finite` parameter. Setting this parameter to `False` will return the
  actual non-finite score in case of perfect predictions or constant `y_true`,
  instead of the finite approximation (`1.0` and `0.0` respectively) currently
  returned by default. :pr:`17266` by :user:`Sylvain Marié <smarie>`.

- |Enhancement| :func:`metrics.top_k_accuracy_score` raises an improved error
  message when `y_true` is binary and `y_score` is 2d. :pr:`22284` by `Thomas Fan`_.

- |API| :class:`metrics.DistanceMetric` has been moved from
  :mod:`sklearn.neighbors` to :mod:`sklearn.metric`.
  Using `neighbors.DistanceMetric` for imports is still valid for
  backward compatibility, but this alias will be removed in 1.3.
  :pr:`21177` by :user:`Julien Jerphanion <jjerphan>`.

- |API| Parameters ``sample_weight`` and ``multioutput`` of :func:`metrics.
  mean_absolute_percentage_error` are now keyword-only, in accordance with `SLEP009
  <https://scikit-learn-enhancement-proposals.readthedocs.io/en/latest/slep009/proposal.html>`_.
  A deprecation cycle was introduced.
  :pr:`21576` by :user:`Paul-Emile Dugnat <pedugnat>`.

- |API| The `"wminkowski"` metric of :class:`sklearn.metrics.DistanceMetric` is deprecated
  and will be removed in version 1.3. Instead the existing `"minkowski"` metric now takes
  in an optional `w` parameter for weights. This deprecation aims at remaining consistent
  with SciPy 1.8 convention. :pr:`21873` by :user:`Yar Khine Phyo <yarkhinephyo>`

- |Fix| :func:`metrics.silhouette_score` now supports integer input for precomputed
  distances. :pr:`22108` by `Thomas Fan`_.

- |Enhancement| :func:`metrics.roc_auc_score` now supports ``average=None``
  in the multiclass case when ``multiclass='ovr'`` which will return the score
  per class. :pr:`19158` by :user:`Nicki Skafte <SkafteNicki>`.

- |Enhancement| Adds `im_kw` parameter to
  :func:`~metrics.ConfusionMatrixDisplay.from_estimator`
  :func:`~metrics.ConfusionMatrixDisplay.from_predictions`, and
  :func:`~metrics.ConfusionMatrixDisplay.plot`. The `im_kw` parameter is passed
  to the `matplotlib.pyplot.imshow` call when plotting the confusion matrix.
  :pr:`20753` by `Thomas Fan`_.

- |Fix| Fixed a bug in :func:`metrics.normalized_mutual_info_score` which could return
  unbounded values. :pr:`22635` by :user:`Jérémie du Boisberranger <jeremiedbb>`.

:mod:`sklearn.model_selection`
..............................

- |Enhancement| raise an error during cross-validation when the fits for all the
  splits failed. Similarly raise an error during grid-search when the fits for
  all the models and all the splits failed. :pr:`21026` by :user:`Loïc Estève <lesteve>`.

- |Enhancement| it is now possible to pass `scoring="matthews_corrcoef"` to all
  model selection tools with a `scoring` argument to use the Matthews
  correlation coefficient (MCC).
  :pr:`22203` by :user:`Olivier Grisel <ogrisel>`.

- |Fix| :class:`model_selection.GridSearchCV`,
  :class:`model_selection.HalvingGridSearchCV`
  now validate input parameters in `fit` instead of `__init__`.
  :pr:`21880` by :user:`Mrinal Tyagi <MrinalTyagi>`.

:mod:`sklearn.mixture`
......................

- |Fix| Fix a bug that correctly initialize `precisions_cholesky_` in
  :class:`mixture.GaussianMixture` when providing `precisions_init` by taking
  its square root.
  :pr:`22058` by :user:`Guillaume Lemaitre <glemaitre>`.

:mod:`sklearn.multiclass`
.........................

- |Enhancement| :class:`multiclass.OneVsRestClassifier` now supports a `verbose`
  parameter so progress on fitting can be seen.
  :pr:`22508` by :user:`Chris Combs <combscCode>`.

- |Fix| :meth:`multiclass.OneVsOneClassifier.predict` returns correct predictions when
  the inner classifier only has a :term:`predict_proba`. :pr:`22604` by `Thomas Fan`_.

:mod:`sklearn.neighbors`
........................

- |Enhancement| `utils.validation.check_array` and `utils.validation.type_of_target`
  now accept an `input_name` parameter to make the error message more
  informative when passed invalid input data (e.g. with NaN or infinite
  values).
  :pr:`21219` by :user:`Olivier Grisel <ogrisel>`.

- |Enhancement| :func:`utils.validation.check_array` returns a float
  ndarray with `np.nan` when passed a `Float32` or `Float64` pandas extension
  array with `pd.NA`. :pr:`21278` by `Thomas Fan`_.

- |Enhancement| Adds :term:`get_feature_names_out` to
  :class:`neighbors.RadiusNeighborsTransformer`, :class:`neighbors.KNeighborsTransformer`
  and :class:`neighbors.NeighborhoodComponentsAnalysis`. :pr:`22212` by
  :user:`Meekail Zain <micky774>`.

- |Fix| :class:`neighbors.KernelDensity` now validates input parameters in `fit`
  instead of `__init__`. :pr:`21430` by :user:`Desislava Vasileva <DessyVV>` and
  :user:`Lucy Jimenez <LucyJimenez>`.

- |Fix| :func:`neighbors.KNeighborsRegressor.predict` now works properly when
  given an array-like input if `KNeighborsRegressor` is first constructed with a
  callable passed to the `weights` parameter. :pr:`22687` by
  :user:`Meekail Zain <micky774>`

:mod:`sklearn.neural_network`
.............................

- |Enhancement| :func:`neural_network.MLPClassifier` and
  :func:`neural_network.MLPRegressor` show error
  messages when optimizers produce non-finite parameter weights. :pr:`22150`
  by :user:`Christian Ritter <chritter>` and :user:`Norbert Preining <norbusan>`.

- |Enhancement| Adds :term:`get_feature_names_out` to
  :class:`neural_network.BernoulliRBM`. :pr:`22248` by `Thomas Fan`_.

:mod:`sklearn.pipeline`
.......................

- |Enhancement| Added support for "passthrough" in :class:`FeatureUnion`.
  Setting a transformer to "passthrough" will pass the features unchanged.
  :pr:`20860` by :user:`Shubhraneel Pal <shubhraneel>`.

- |Fix| :class:`pipeline.Pipeline` now does not validate hyper-parameters in
  `__init__` but in `.fit()`.
  :pr:`21888` by :user:`iofall <iofall>` and :user:`Arisa Y. <arisayosh>`.

- |Fix| :class:`pipeline.FeatureUnion` does not validate hyper-parameters in
  `__init__`. Validation is now handled in `.fit()` and `.fit_transform()`.
  :pr:`21954` by :user:`iofall <iofall>` and :user:`Arisa Y. <arisayosh>`.

:mod:`sklearn.preprocessing`
............................

- |Feature| :class:`preprocessing.OneHotEncoder` now supports grouping
  infrequent categories into a single feature. Grouping infrequent categories
  is enabled by specifying how to select infrequent categories with
  `min_frequency` or `max_categories`. :pr:`16018` by `Thomas Fan`_.

- |Enhancement| Adds a `subsample` parameter to :class:`preprocessing.KBinsDiscretizer`.
  This allows specifying a maximum number of samples to be used while fitting
  the model. The option is only available when `strategy` is set to `quantile`.
  :pr:`21445` by :user:`Felipe Bidu <fbidu>` and :user:`Amanda Dsouza <amy12xx>`.

- |Enhancement| Added the `get_feature_names_out` method and a new parameter
  `feature_names_out` to :class:`preprocessing.FunctionTransformer`. You can set
  `feature_names_out` to 'one-to-one' to use the input features names as the
  output feature names, or you can set it to a callable that returns the output
  feature names. This is especially useful when the transformer changes the
  number of features. If `feature_names_out` is None (which is the default),
  then `get_output_feature_names` is not defined.
  :pr:`21569` by :user:`Aurélien Geron <ageron>`.

- |Fix| :class:`preprocessing.LabelBinarizer` now validates input parameters in
  `fit` instead of `__init__`.
  :pr:`21434` by :user:`Krum Arnaudov <krumeto>`.

- |Fix| :class:`preprocessing.FunctionTransformer` with `check_inverse=True`
  now provides informative error message when input has mixed dtypes. :pr:`19916` by
  :user:`Zhehao Liu <MaxwellLZH>`.

- |Enhancement| Adds :meth:`get_feature_names_out` to
  :class:`preprocessing.Normalizer`,
  :class:`preprocessing.KernelCenterer`,
  :class:`preprocessing.OrdinalEncoder`, and
  :class:`preprocessing.Binarizer`. :pr:`21079` by `Thomas Fan`_.

- |Fix| :class:`preprocessing.KBinDiscretizer` handles bin edges more consistently now.
  :pr:`14975` by `Andreas Müller`_ and :pr:`22526` by :user:`Meekail Zain <micky774>`.

- |Fix| Adds :meth:`preprocessing.KBinDiscretizer.get_feature_names_out` support when
  `encode="ordinal"`. :pr:`22735` by `Thomas Fan`_.

:mod:`sklearn.random_projection`
................................

- |Enhancement| :class:`random_projection.SparseRandomProjection` and
  :class:`random_projection.GaussianRandomProjection` preserves dtype for
  `numpy.float32`. :pr:`22114` by :user:`Takeshi Oura <takoika>`.

- |Enhancement| Adds an :meth:`inverse_transform` method and a
  `compute_inverse_transform` parameter to all transformers in the
  :mod:`~sklearn.random_projection` module:
  :class:`~sklearn.random_projection.GaussianRandomProjection` and
  :class:`~sklearn.random_projection.SparseRandomProjection`. When the parameter is set
  to True, the pseudo-inverse of the components is computed during `fit` and stored as
  `inverse_components_`. :pr:`21701` by `Aurélien Geron <ageron>`.

- |Enhancement| Adds :term:`get_feature_names_out` to all transformers in the
  :mod:`~sklearn.random_projection` module:
  :class:`~sklearn.random_projection.GaussianRandomProjection` and
  :class:`~sklearn.random_projection.SparseRandomProjection`. :pr:`21330` by
  :user:`Loïc Estève <lesteve>`.

:mod:`sklearn.svm`
..................

- |Enhancement| :class:`svm.OneClassSVM`, :class:`svm.NuSVC`,
  :class:`svm.NuSVR`, :class:`svm.SVC` and :class:`svm.SVR` now expose
  `n_iter_`, the number of iterations of the libsvm optimization routine.
  :pr:`21408` by :user:`Juan Martín Loyola <jmloyola>`.

- |Enhancement| :func:`svm.SVR`, :func:`svm.SVC`, :func:`svm.NuSVR`,
  :func:`svm.OneClassSVM`, :func:`svm.NuSVC` now raise an error
  when the dual-gap estimation produce non-finite parameter weights.
  :pr:`22149` by :user:`Christian Ritter <chritter>` and
  :user:`Norbert Preining <norbusan>`.

- |Fix| :class:`smv.NuSVC`, :class:`svm.NuSVR`, :class:`svm.SVC`,
  :class:`svm.SVR`, :class:`svm.OneClassSVM` now validate input
  parameters in `fit` instead of `__init__`.
  :pr:`21436` by :user:`Haidar Almubarak <Haidar13 >`.

:mod:`sklearn.tree`
...................

- |Fix| Fix a bug in the Poisson splitting criterion for
  :class:`tree.DecisionTreeRegressor`.
  :pr:`22191` by :user:`Christian Lorentzen <lorentzenchr>`.

:mod:`sklearn.utils`
....................

- |Enhancement| :func:`utils.estimator_html_repr` shows a more helpful error
  message when running in a jupyter notebook that is not trusted. :pr:`21316`
  by `Thomas Fan`_.

- |Enhancement| :func:`utils.estimator_html_repr` displays an arrow on the top
  left corner of the HTML representation to show how the elements are
  clickable. :pr:`21298` by `Thomas Fan`_.

- |API| :func:`utils.estimator_checks.check_estimator`'s argument is now called
  `estimator` (previous name was `Estimator`). :pr:`22188` by
  :user:`Mathurin Massias <mathurinm>`.

- |Enhancement| :func:`utils.validation.check_scalar` now has better messages
  when displaying the type. :pr:`22218` by `Thomas Fan`_.

- |Fix| :func:`check_scalar` raises an error when `include_boundaries={"left", "right"}`
  and the boundaries are not set.
  :pr:`22027` by `Marie Lanternier <mlant>`.

- |Fix| Estimators with `non_deterministic` tag set to `True` will skip both
  `check_methods_sample_order_invariance` and `check_methods_subset_invariance` tests.
  :pr:`22318` by `Zhehao Liu <MaxwellLZH>`.

- |Fix| Changes the error message of the `ValidationError` raised by
  :func:`utils.validation.check_X_y` when y is None so that it is compatible
  with :func:`utils.estimator_checks.check_requires_y_none`. :pr:`22578` by
  :user:`Claudio Salvatore Arcidiacono <ClaudioSalvatoreArcidiacono>`.

- |Fix| :func:`utils.class_weight.compute_class_weight` now only requires that
  all classes in `y` have a weight in `class_weight`. An error is still raised
  when a class is present in `y` but not in `class_weight`. :pr:`22595` by
  `Thomas Fan`_.

- |Fix| :func:`utils.estimator_html_repr` has an improved visualization for nested
  meta-estimators. :pr:`21310` by `Thomas Fan`_.

- |API| :func:`utils.metaestimators.if_delegate_has_method` is deprecated and will be
  removed in version 1.3. Use :func:`utils.metaestimators.available_if` instead.
  :pr:`22830` by :user:`Jérémie du Boisberranger <jeremiedbb>`.

Code and Documentation Contributors
-----------------------------------

Thanks to everyone who has contributed to the maintenance and improvement of
the project since version 1.0, including:

TODO: update at the time of the release.
